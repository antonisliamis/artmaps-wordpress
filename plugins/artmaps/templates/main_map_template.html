<script type="text/javascript">
google.maps.visualRefresh = true;
jQuery(function($) {
    var config = {
        "map": {
            "center": new google.maps.LatLng(51.507854, -0.099462), /* Tate Britain */
            "mapTypeId": google.maps.MapTypeId.ROADMAP
        }
    };
    var map = new ArtMaps.Map.MapObject($("#artmaps-map-themap"), config);
    var autocomplete = $("#artmaps-map-autocomplete");
    map.bindAutocomplete(new google.maps.places.Autocomplete(autocomplete.get(0)));
    //map.addControl(autocomplete.get(0));  
    
    (function() {
        var con = $("#artmaps-map-object-container").children().first();
        $("#artmaps-map-object-container").detach();
        ArtMaps.Map.UI.formatMetadata = function(object, metadata) {
            var c = con.clone();
            c.find("a").attr("href", ArtMapsConfig.SiteUrl + "/object/" + object.ID);
            c.find("a.artwork-link").attr("data-fancybox-href", ArtMapsConfig.SiteUrl + "/object/" + object.ID);
            if(typeof metadata.imageurl != "undefined") {
                c.find("img").attr("src", "http://dev.artmaps.org.uk/artmaps/tate/dynimage/x/65/"+metadata.imageurl);
            }
            c.find(".artmaps-map-object-container-title").text(metadata.title);
            c.find(".artmaps-map-object-container-artist").text(metadata.artist);
            c.find(".artmaps-map-object-container-suggestions").text(object.SuggestionCount);
            return c;
        };
    })();
    
    (function() {
        jQuery(window).bind("hashchange", function(e) {
            jQuery.ajax(ArtMapsConfig.AjaxUrl, {
                "type": "post",
                "data": {
                    "action": "artmaps.storeMapState",
                    "data": {
                        "state": e.fragment
                    }
                }
            });
        });
    })();
    
    $(".fancybox").fancybox({
  		maxWidth	: 800,
  		maxHeight	: 600,
  		fitToView	: true,
  		width		: '70%',
  		height		: '70%',
  		autoSize	: false,
  		closeClick	: false,
  		showEarly   : false,
  		openEffect	: 'fade',
  		closeEffect	: 'fade'
  	});
});
</script>

<div id="artmaps-map-themap"></div>

<div id="artmaps-map-object-list-container-page" style="display: none;">
    <div class="artmaps-map-object-list-container-page">
        <ul class="artmaps-map-object-list-container-page-body"></ul>
        <div class="artmaps-map-object-list-container-page-nav">
      <span class="artmaps-map-object-list-container-page-previous artmaps-button">&larr; Prev</span>
      <span class="artmaps-map-object-list-container-page-current">Page 1 of 1</span>
      <span class="artmaps-map-object-list-container-page-next artmaps-button">Next &rarr;</span>
    </div>
    </div>
</div>

    <div id="artmaps-map-object-container" style="display: none;">
       <li class="artmaps-map-object-container">
         <a class="fancybox.ajax artwork-link fancybox">
            <img src="http://dev.artmaps.org.uk/artmaps/tate/dynimage/x/65/{'content/unavailable.jpg'|artmapsUri}" />
            <h2 class="artmaps-map-object-container-title"></h2>
            <em>by <span class="artmaps-map-object-container-artist"></span></em>
            <span class="artmaps-map-object-container-suggestions"></span>
         </a>
        <li>
    </div>
